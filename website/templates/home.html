{% extends 'base.html' %}

{% block title %} Home {% endblock %}

{% block body %}
<!-- Top bar -->
<div class="top-bar">
    <div class="container-fluid">
        <ul class="nav justify-content-center">
            <li class="nav-item">
                <a class="nav-link" href="#">Nâng cấp hội viên</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Combo</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Khóa học miễn phí</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Hướng dẫn</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Blog</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="priceFilterDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Lọc theo giá
                </a>
                <ul class="dropdown-menu" aria-labelledby="priceFilterDropdown">
                    <li><a class="dropdown-item" href="#">Dưới 50.000 VNĐ</a></li>
                    <li><a class="dropdown-item" href="#">50.000 - 100.000 VNĐ</a></li>
                    <li><a class="dropdown-item" href="#">100.000 - 200.000 VNĐ</a></li>
                    <li><a class="dropdown-item" href="#">Trên 200.000 VNĐ</a></li>
                </ul>
            </li>
            <!-- Sắp xếp dropdown -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="orderFilterDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Sắp xếp
                </a>
                <ul class="dropdown-menu" aria-labelledby="orderFilterDropdown">
                    <li><a class="dropdown-item" href="#">Mới nhất</a></li>
                    <li><a class="dropdown-item" href="#">Từ thấp đến cao</a></li>
                    <li><a class="dropdown-item" href="#">Từ cao xuống thấp</a></li>
                </ul>
            </li>
        </ul>
    </div>
</div>

<!-- Row cho Carousel và Card khóa học -->
<div class="container-custom">
    <div class="row d-flex">
        <!-- Card danh mục khóa học -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5>Danh mục khóa học</h5>
                </div>
                <div class="row">
                    <div class="col-6">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">Ads</li>
                            <li class="list-group-item">SEO</li>
                            <li class="list-group-item">Shopee</li>
                            <li class="list-group-item">TikTok</li>
                            <li class="list-group-item">Tài chính - Kết toán</li>
                            <li class="list-group-item">Phòng The</li>
                            <li class="list-group-item">Phong Thủy</li>
                            <li class="list-group-item">Dựng video</li>
                        </ul>
                    </div>
                    <div class="col-6">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">Lập trình WEB</li>
                            <li class="list-group-item">Copy Writing</li>
                            <li class="list-group-item">Data Analysis</li>
                            <li class="list-group-item">Bất động sản</li>
                            <li class="list-group-item">Kiếm tiền online</li>
                            <li class="list-group-item">Tin học văn phòng</li>
                            <li class="list-group-item">Đồ họa thiết kế</li>
                            <li class="list-group-item">Kinh doanh - Marketing</li>
                            <li class="list-group-item">Tiếng Trung - Nhật - Hàn</li>
                            <li class="list-group-item">Crypto - Forex - Chứng khoán </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carousel (Slider) nằm bên phải -->
        <div class="col-md-8 mb-4">
            <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="https://aimacademy.vn/wp-content/uploads/2023/11/45229-374-Thumb-Post-Lo-Trinh-Tu-Hoc-Marketing-Co-Ban.jpg" class="d-block w-100" alt="Khóa học Marketing Online">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>Khóa Học Marketing Online</h5>
                            <p>Giới thiệu cách thức marketing trên nền tảng trực tuyến để tối ưu hóa hiệu quả kinh doanh.</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="https://i.ytimg.com/vi/CQqBQVH5PcI/maxresdefault.jpg" class="d-block w-100" alt="Khóa học AI và Machine Learning">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>Khóa Học AI và Machine Learning</h5>
                            <p>Khóa học chi tiết về AI và cách thức áp dụng Machine Learning vào trong các dự án thực tế.</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="https://vtiacademy.edu.vn/upload/images/lap-trinh-web.jpg" class="d-block w-100" alt="Khóa học Lập Trình Web">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>Khóa Học Lập Trình Web</h5>
                            <p>Khóa học này giúp bạn học lập trình web từ cơ bản đến nâng cao, phù hợp với mọi đối tượng.</p>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
            <div class="container-fluid mt-4">
                <div class="card shadow-lg mb-4 mx-auto" style="max-width: 1200px; background-color: #fdfd96; border: 2px solid #97c8e7;">
                    <div class="card-header">
                        <h5>KHO KHÓA HỌC - SHARE HƠN 5000 KHÓA HỌC ONLINE</h5>
                    </div>
                    <div class="card-body">
                        <p>Tổng kho khóa học online lớn nhất hiện nay, uy tín, chất lượng và nhanh chóng. Chúng tôi liên tục cập nhật các khóa học mới đáp ứng nhu cầu của các bạn.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="full-width-container py-5">
    <div class="text-center">
        <h2>Vì sao chọn chúng tôi?</h2>
        <p class="text-muted">Chúng tôi luôn cố gắng mang lại những dịch vụ tốt nhất cho bạn.</p>
    </div>
    <!-- Các mục bên dưới -->
    <div class="row justify-content-between">
        <!-- Mục 1 -->
        <div class="col-md-3 mb-4">
            <div class="card full-width-card shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-bar-chart-line" style="font-size: 3rem; color: #17a2b8;"></i>
                    <h5 class="card-title">Uy tín chất lượng</h5>
                    <p class="card-text">Hoàn tiền nếu khóa học không như mô tả</p>
                </div>
            </div>
        </div>

        <!-- Mục 2 -->
        <div class="col-md-3 mb-4">
            <div class="card full-width-card shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-clock" style="font-size: 3rem; color: #28a745;"></i>
                    <h5 class="card-title">Kích hoạt nhanh</h5>
                    <p class="card-text">Kích hoạt khóa học tự động</p>
                </div>
            </div>
        </div>

        <!-- Mục 3 -->
        <div class="col-md-3 mb-4">
            <div class="card full-width-card shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-arrow-repeat" style="font-size: 3rem; color: #ffc107;"></i>
                    <h5 class="card-title">Update liên tục</h5>
                    <p class="card-text">Cập nhật 7-15 khóa học mới hằng tuần</p>
                </div>
            </div>
        </div>

        <!-- Mục 4 -->
        <div class="col-md-3 mb-4">
            <div class="card full-width-card shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-laptop" style="font-size: 3rem; color: #007bff;"></i>
                    <h5 class="card-title">Học online tiện lợi</h5>
                    <p class="card-text">Học online bằng điện thoại hoặc máy tính</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Top khóa học bán chạy -->
<div class="container my-5">
    <div class="text-center mb-4">
        <h4 class="fw-bold">TOP KHÓA HỌC BÁN CHẠY</h4>
        <p class="text-muted">Tổng hợp những khóa học bán chạy nhất trong tháng.</p>
    </div>

    <div class="row g-3 justify-content-center">
        {% for item in items %}
        <div class="col-6 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 shadow-sm">
                <img src="{{ item.product_picture }}" class="card-img-top" alt="{{ item.product_name }}" style="height: 160px; object-fit: cover; border-top-left-radius: .5rem; border-top-right-radius: .5rem;">
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title text-truncate" title="{{ item.product_name }}">{{ item.product_name }}</h6>
                    <div class="mt-auto">
                        <div class="mb-2">
                            <span class="text-danger fw-bold">{{ item.current_price }} VNĐ</span><br>
                            {% if item.previous_price %}
                            <small class="text-muted"><del>{{ item.previous_price }} VNĐ</del></small>
                            {% endif %}
                        </div>
                        <a href="/add-to-cart/{{ item.id }}" class="btn btn-sm btn-outline-primary w-100 mb-1">
                            <i class="bi bi-cart-plus"></i> Thêm giỏ hàng
                        </a>
                        <a href="/course-detail/{{ item.id }}" class="btn btn-sm btn-secondary w-100">
                            <i class="bi bi-info-circle"></i> Xem thông tin
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="text-center mt-4">
        <a href="/all-courses" class="btn btn-secondary">Xem tất cả</a>
    </div>
</div>

<!-- Chatbot container -->
<div class="chatbot-container">
    <!-- Nút mở chatbot -->
    <div class="chatbot-toggle" onclick="toggleChatbot()">
        <i class="bi bi-chat-dots-fill"></i>
    </div>

    <!-- Cửa sổ chatbot -->
    <div class="chatbot-window" id="chatbotWindow" style="display: none;">
        <div class="chatbot-header">
            <h5>Chat với chúng tôi!</h5>
            <button class="chatbot-close" onclick="toggleChatbot()">×</button>
        </div>
        <div class="chatbot-body" id="chatbotMessages">
            <div class="chatbot-message bot-message">
                Xin chào! Tôi có thể giúp gì cho bạn hôm nay?
            </div>
        </div>
        <div class="chatbot-footer">
            <input type="text" id="chatbotInput" placeholder="Nhập tin nhắn..." onkeypress="if(event.key === 'Enter') sendMessage()">
            <button onclick="sendMessage()"><i class="bi bi-send"></i></button>
        </div>
    </div>
</div>

<style>
.chatbot-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}

.chatbot-toggle {
    background-color: #007bff;
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.chatbot-window {
    width: 350px;
    height: 500px;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
    position: absolute;
    bottom: 80px;
    right: 0;
}

.chatbot-header {
    background-color: #007bff;
    color: white;
    padding: 12px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chatbot-header h5 {
    margin: 0;
    font-size: 16px;
}

.chatbot-close {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
}

.chatbot-body {
    flex: 1; /* Chiếm toàn bộ không gian còn lại */
    padding: 15px;
    overflow-y: auto; /* Đảm bảo cuộn dọc */
    border-bottom: 1px solid #ddd;
    display: block; /* Sử dụng block thay vì flex để tránh xung đột bố cục */
    max-height: 400px; /* Giới hạn chiều cao tối đa để cuộn */
}

.chatbot-message {
    padding: 8px 12px;
    border-radius: 15px;
    max-width: 70%;
    word-wrap: break-word;
    line-height: 1.4;
    margin-bottom: 10px; /* Khoảng cách giữa các tin nhắn */
}

.bot-message {
    background-color: #f1f1f1;
    color: #333;
    align-self: flex-start;
}

.user-message {
    background-color: #007bff;
    color: white;
    align-self: flex-end;
}

.chatbot-footer {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ddd;
    min-height: 50px; /* Đảm bảo footer không bị co lại quá nhỏ */
}

.chatbot-footer input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 20px;
    margin-right: 10px;
    outline: none;
}

.chatbot-footer button {
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}
</style>

<script>
// Hàm mở/đóng chatbot
function toggleChatbot() {
    const chatbotWindow = document.getElementById('chatbotWindow');
    chatbotWindow.style.display = chatbotWindow.style.display === 'none' ? 'block' : 'none';
}

// Hàm gửi tin nhắn
function sendMessage() {
    const input = document.getElementById('chatbotInput');
    const message = input.value.trim();
    if (!message) return;

    // Hiển thị tin nhắn của người dùng
    const messagesContainer = document.getElementById('chatbotMessages');
    const userMessage = document.createElement('div');
    userMessage.className = 'chatbot-message user-message';
    userMessage.textContent = message;
    messagesContainer.appendChild(userMessage);

    // Xóa input và cuộn xuống tin nhắn mới nhất
    input.value = '';
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // Gửi tin nhắn đến server và nhận phản hồi
    fetch('/chatbot', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ message: message })
    })
    .then(response => response.json())
    .then(data => {
        // Hiển thị phản hồi từ bot
        const botMessage = document.createElement('div');
        botMessage.className = 'chatbot-message bot-message';
        botMessage.textContent = data.reply;
        messagesContainer.appendChild(botMessage);

        // Cuộn xuống tin nhắn mới nhất
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    })
    .catch(error => {
        console.error('Lỗi khi gửi tin nhắn:', error);
        const errorMessage = document.createElement('div');
        errorMessage.className = 'chatbot-message bot-message';
        errorMessage.textContent = 'Có lỗi xảy ra, vui lòng thử lại!';
        messagesContainer.appendChild(errorMessage);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    });
}
</script>

{% endblock %}
